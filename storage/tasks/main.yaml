---
- name: Check {{ storage.mountpoint }} mountpoint exist
  become: yes
  file:
    path: '{{ storage.mountpoint }}'
    state: directory
    owner: root
    group: root

- name: Add /data partition in fstab on {{ storage.mountpoint }} if undefined
  become: yes
  lineinfile:
    state: present
    path: '/etc/fstab'
    regexp: "^{{ storage.nfs }}"
    line: '{{ storage.nfs }} {{ storage.mountpoint }}       {{ storage.type }}     defaults,proto=tcp,noatime      0       0'

- name: Check {{ storage.nfs }} nfs is mounted
  become: yes
  shell: 'sudo mount -l | grep {{ storage.nfs }} | wc -l'
  register: data_nfs_is_mounted

- name: Mount {{ storage.nfs }} network share
  become: yes
  command: 'sudo mount {{ storage.mountpoint }}'
  when: data_nfs_is_mounted.stdout == "0"
